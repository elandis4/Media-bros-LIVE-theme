
<!-- BEGIN USF -->
{% assign page_title  =  collection.title %}
<script>
    document.title = '{{ page_title }} - {{ shop.name}}'; 
</script>
<style>
.collection-sidebar,
.collection-sidebar .mfp-close {
    background-color: {{ settings.color_drawer_bg }};
}
  .collection__header-media{
    opacity:1!important;
  }
  .collection__header-img { 
    object-fit: contain; 
}
</style>
<section class="section" data-section-id="{{ section.id }}" data-section-type="collection-template">
    <div class="collection{% if collection.image and section.settings.show_collection_image %} collection--img{% endif %}{% if section.settings.center_title %} collection--center{% endif %}">

         <div class="container">
            <div class="collection__header{% if collection.image and section.settings.show_collection_image %} collection__header--img{% endif %}">
                {% if collection.image and section.settings.show_collection_image %}
                    <div class="collection__header-media o-ratio o-ratio--{{ section.settings.collection_image_height }}" style="width: 100%;background-image: url('{{ collection.image | img_url: '1x1' }}');">
                        <img
                            class="collection__header-img collection__header-img--{{ section.id }}"
                            src="{{ collection.image | img_url: '600x' }}"
                            srcset="{% render 'bgset', image: collection.image %}"
                            width="600"
                            height="{{ 600 | divided_by: collection.image.aspect_ratio | round }}"
                            alt="{{ collection.image.alt }}"
                            loading="lazy"
                        />
                    </div>
                {% endif %}
                <div class="collection__header-info">
                    <div class="section__title collection__header-info__title{% if section.settings.center_title %} section__title--center{% endif %}" style="visibility: visible; opacity: 1; transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transition: opacity 0.6s cubic-bezier(0.5, 0, 0, 1) 0s, transform 0.6s cubic-bezier(0.5, 0, 0, 1) 0s;">
                        <h1 class="section__title-text collection__header-info__title-text">{{ collection.title }}</h1>
                    </div>
                    {% if collection.description != blank %}
                        <div class="collection__header-info__text rte rte--header" style="visibility: visible; opacity: 1; transition: opacity 0.6s cubic-bezier(0.5, 0, 0, 1) 0.1s;">
                            {{ collection.description }}
                        </div>
                    {% endif %}
                </div>
            </div>

            {%- assign mobile_sizes = 100 | divided_by: section.settings.grid_mobile -%}
            {%- assign sizes = mobile_sizes -%}
            {% case section.settings.grid %}
                {% when 2 %}
                    {%- assign grid_item_width = 'u-1/2@phab' -%}
                    {%- assign image_size = '740x' -%}
                    {%- assign sizes = '(min-width: 561px) 50vw, ' | append: mobile_sizes | append: 'vw' -%}
                    {% if section.settings.show_sidebar and section.blocks.size > 0 and section.settings.sidebar_layout == 'sidebar' %}
                        {%- assign container_size = 'full' -%}
                    {% else %}
                        {%- assign container_size = 'large' -%}
                    {% endif %}
                {% when 3 %}
                    {%- assign grid_item_width = 'u-1/2@phab u-1/3@tab' -%}
                    {%- assign image_size = '520x' -%}
                    {%- assign sizes = '(min-width: 561px) 50vw, (min-width: 768px) 33vw, ' | append: mobile_sizes | append: 'vw' -%}
                    {% if section.settings.show_sidebar and section.blocks.size > 0 and section.settings.sidebar_layout == 'sidebar' %}
                        {%- assign container_size = 'full' -%}
                    {% else %}
                        {%- assign container_size = 'large' -%}
                    {% endif %}
                {% when 4 %}
                    {%- assign grid_item_width = 'u-1/3@tab u-1/4@desk' -%}
                    {%- assign image_size = '380x' -%}
                    {%- assign container_size = 'full' -%}
                    {%- assign sizes = '(min-width: 768px) 33vw, (min-width: 981px) 25vw, ' | append: mobile_sizes | append: 'vw' -%}
            {% endcase %}
        </div>

	</div>
  {% case section.settings.grid %}
      {% when 2 %}
         {%- assign grid_item_width = 'u-1/2@phab' -%}
         {%- assign image_size = '740x' -%}
      {% when 3 %}
          {%- assign grid_item_width = 'u-1/2@phab u-1/3@tab' -%}
          {%- assign image_size = '520x' -%}
       {% when 4 %}
          {%- assign grid_item_width = 'u-1/3@tab u-1/4@desk' -%}
           {%- assign image_size = '380x' -%}
   {% endcase %}
   {% case settings.product_grid_image_size %}
         {% when 'natural' %}
             {%- assign product_ratio = 'custom' -%}
          {% when 'fit-square' or 'crop-square' %}
                {%- assign product_ratio = '1:1' -%}
          {% when 'fit-short' or 'crop-short' %}
                 {%- assign product_ratio = '4:3' -%}
         {% when 'fit-tall' or 'crop-tall' %}
            {%- assign product_ratio = '2:3' -%}
   {% endcase %}
  {% capture default_grid %}
  {%- assign limit = section.settings.grid | times: section.settings.rows -%}
  {% paginate collection.products by limit %}
                <div class="collection-products">

                    {% comment %}Sidebar blocks count{% endcomment %}
                    {% if section.settings.show_sidebar and section.blocks.size > 0 or true %}
                    <div class="o-layout">

                        <div class="o-layout__item u-1/1 u-1/4@desk">
                            <aside class="collection-sidebar collection-sidebar--{{ section.settings.sidebar_layout }} collection-sidebar--{{ settings.color_drawer_style }} js-collection-draw">
                                <div class="collection-sidebar__wrapper">
                                    {% include 'filter-menu' %}

{% for block in section.blocks %}
                                        {% if block.type == 'linklist' %}
                                            {% if linklists[block.settings.linklist].links.size > 0 %}
                                                <div class="collection-sidebar__section">
                                                    <h4 class="collection-sidebar__title h5">{{ linklists[block.settings.linklist].title }}</h4>
                                                    <ul class="collection-sidebar__items o-list-bare">
                                                        {% for link in linklists[block.settings.linklist].links %}
                                                            {%- comment %}<locksmith:5c69>{% endcomment -%}
                                                              {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: link, subject_parent: linklists[block.settings.linklist], variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
                                                            {%- comment %}</locksmith:5c69>{% endcomment -%}
                                                            <li class="collection-sidebar__item{% if link.active %} collection-sidebar__item--active{% endif %}">
                                                                <a href="{{ link.url }}" class="collection-sidebar__link">{{ link.title }}</a>
                                                            </li>
                                                        {% endfor %}
                                                    </ul>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                        {% if block.type == 'tags' %}
                                            {% if collection.all_tags.size > 0 %}
                                                <div class="collection-sidebar__section collection-sidebar__section--tags">
                                                    <h4 class="collection-sidebar__title h5">
                                                        {{ block.settings.title | escape }}
                                                    </h4>
                                                    <ul class="collection-sidebar__items o-list-bare">
                                                        {% for tag in collection.all_tags %}
                                                            {% if current_tags contains tag %}
                                                                <li class="collection-sidebar__item collection-sidebar__item--active">
                                                                    {{ tag | link_to_remove_tag: tag | replace: ' title', ' class="collection-sidebar__link" title' }}
                                                                </li> 
                                                            {% endif %}
                                                        {% endfor %}
                                                        {% for tag in collection.all_tags %}
                                                            {% unless current_tags contains tag %}
                                                                <li class="collection-sidebar__item">
                                                                    {{ tag | link_to_add_tag: tag | replace: ' title', ' class="collection-sidebar__link" title' }}
                                                                </li>
                                                            {% endunless %}
                                                        {% endfor %}
                                                    </ul>
                                                </div>
                                                {% if current_tags %}
                                                    <div class="collection-sidebar__section collection-sidebar__section--group-clear">
                                                        <a href="{{ collection.url }}" class="c-btn c-btn--small c-btn--light c-btn--close">{{ 'collections.general.tags_clear_filters' | t }}</a>
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                        {% endif %}
                                        {% if block.type == 'group' %}
                                            {% if template contains 'collection' and collection.all_tags.size > 1 %}
                                                <!-- A recursive loop to catch and filter out the different tag categories -->
                                                {% assign c = 0 %} 
                                                {% for t in collection.all_tags %}
                                                    {% capture cat %}{{ cat }}{% capture temp_cat %}{% if t contains '_' %}{% assign cat_grp = t | split: '_' %}{{ cat_grp.first }}{% endif %}{% endcapture %}{% unless cat contains temp_cat %}{% if t contains '_' %}{% assign new_cat_grp = t | split: '_' %}{{ new_cat_grp.first }}{% endif %}{% unless forloop.last %}+{% endunless %}{% assign c = c | plus: 1 %}{% endunless %}{% endcapture %}
                                                {% endfor %}

                                                <!-- create array of tag categories -->
                                                {% assign cat_array = cat | split: '+' %}

                                                <!-- loop through tag categories -->  
                                                {% for i in cat_array %}
                                                    <!-- ignore if tag category is empty -->  
                                                    {% unless i == '' %}
                                                        <div class="collection-sidebar__section collection-sidebar__section--tags collection-sidebar__section--group">
                                                            <h4 class="collection-sidebar__title h5">{{ i }}</h4>
                                                            <ul class="collection-sidebar__items o-list-bare">
                                                                <!-- loop through collection tags -->  
                                                                {% for t in collection.all_tags %}
                                                                    <!-- if tag contains the category title -->
                                                                    {% if t contains i %}
                                                                        <!-- strip out tag category prefix and add/remove link for tag filtering -->
                                                                        {% if current_tags contains t %}
                                                                            <li class="collection-sidebar__item collection-sidebar__item--active">
                                                                                {{ t | remove: i | remove: '_' | link_to_remove_tag: t | replace: ' title', ' class="collection-sidebar__link" title' }}
                                                                            </li> 
                                                                        {% else %}
                                                                            <li class="collection-sidebar__item">
                                                                                {{ t | remove: i | remove: '_' | link_to_add_tag: t | replace: ' title', ' class="collection-sidebar__link" title' }}
                                                                            </li>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </ul>
                                                        </div>
                                                    {% endunless %}
                                                {% endfor %}

                                                {% if current_tags %}
                                                    <div class="collection-sidebar__section collection-sidebar__section--group-clear">
                                                        <a href="{{ collection.url }}" class="c-btn c-btn--small c-btn--light c-btn--close">{{ 'collections.general.tags_clear_filters' | t }}</a>
                                                    </div>
                                                {% endif %}

                                            {% endif %}                                    
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </aside>
                        </div>

                        <div class="o-layout__item u-1/1 {% if section.settings.sidebar_layout == 'sidebar' %}u-3/4@desk{% else %}u-1/1@desk{% endif %}">

                    {% endif %}
                    {% comment %}Sidebar blocks count{% endcomment %}

                            <div class="o-layout{% if settings.product_grid_masonry %} o-layout--masonry{% endif %}{% if section.settings.grid == 4 %} o-layout--small{% endif %}{% if section.settings.grid_mobile == '2' %} o-layout--small@tab-down{% endif %}">
                                {% for product in collection.products %}
                                    {%- comment %}<locksmith:1b2e>{% endcomment -%}
                                      {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: product, subject_parent: collection, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
                                    {%- comment %}</locksmith:1b2e>{% endcomment -%}
                                    <div class="o-layout__item u-1/{{ section.settings.grid_mobile }} {{ grid_item_width }}">
                                        {% include 'product-grid-item', grid_image_width: image_size, page: 'collection' %}
                                    </div>
                                {% else %}
                                    {% if collection.handle == 'all' and collection.all_vendors.size == 0 and collection.all_types.size == 0 %}
                                        {% comment %}
                                            Add default products to help with onboarding for collections/all only.
                                        {% endcomment %}
                                        {% for i in (1..8) %}
                                            <div class="o-layout__item u-1/{{ section.settings.grid_mobile }} {{ grid_item_width }}">
                                                <a href="#" class="product-link home-products__link">
                                                    <div class="product product--{{ settings.product_grid_align }}">
                                                        <div class="product__media u-bg-{{ settings.product_grid_bg }}">
                                                            {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
                                                            {{ 'product-' | append: current | placeholder_svg_tag: 'product__img placeholder-svg' }}
                                                        </div>
                                                        <div class="product__details product__details--{{ settings.product_grid_text_size }}">
                                                            <h3 class="product__title">{{ 'homepage.onboarding.product_title' | t }}</h3>
                                                            {% if settings.product_grid_vendor %}
                                                                <p class="product__vendor">{{ 'homepage.onboarding.product_vendor' | t }}</p>
                                                            {% endif %}
                                                            <p class="product__price">
                                                                {% include 'product-price' %}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="o-layout__item 1/1">
                                            <div class="collection-empty">
                                                <h5 class="collection-empty__title">{{ 'collections.general.no_matches' | t }}</h5>
                                                <span class="emoji collection-empty__emoji">
                                                    <i class="icon icon--confused"></i>
                                                </span>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>

                    {% comment %}Sidebar blocks count{% endcomment %}
                    {% if section.settings.show_sidebar and section.blocks.size > 0 or true %}
                        </div>                        
                    </div>
                    {% endif %}
                    {% comment %}Sidebar blocks count{% endcomment %}
                </div>

            {% if paginate.pages > 1 %}
                <div class="collection-pagination">
                    <div class="container">
                        <div class="pagination">
                            <div class="pagination__items">
                                {{ paginate | default_pagination: next: '<i class="icon icon--right-t"></i>', previous: '<i class="icon icon--left-t"></i>' }}
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
  {%- endpaginate -%} 
  {% endcapture %}

  
  <script>
    window.usf_globalSettings = {
      product_grid_masonry: {{ settings.product_grid_masonry | json }},
      product_grid_detail_style: {{ settings.product_grid_detail_style | json }},
      product_grid_image_size: {{ settings.product_grid_image_size | json }},
      product_grid_align: {{ settings.product_grid_align | json }},
      product_grid_label: {{ settings.product_grid_label | json }},
      product_grid_label_collection: {{ settings.product_grid_label_collection | json }},
      product_grid_label_sale_style: {{ settings.product_grid_label_sale_style | json }},
      product_grid_label_new: {{ settings.product_grid_label_new | json }},
      product_grid_label_new_days: {{ settings.product_grid_label_new_days | json }},
      product_grid_second_hover: {{ settings.product_grid_second_hover | json }},
      product_grid_quick_buy: {{ settings.product_grid_quick_buy | json }},
      product_grid_vendor: {{ settings.product_grid_vendor | json }},
      product_grid_price: {{ settings.product_grid_price | json }},
      product_reviews: {{ settings.product_reviews | json }},
      product_grid_reviews: {{ settings.product_grid_reviews | json }},
      product_grid_swatch: {{ settings.product_grid_swatch | json }},
      product_grid_swatch_image: {{ settings.product_grid_swatch_image | json }},
      secondary_images_hover: {{ settings.secondary_images_hover | json }}
    };
     window.usf_sectionSettings = {
      	grid: {{ section.settings.grid | json }},
      	grid_mobile: {{ section.settings.grid_mobile | json }},
    };
    window.usf_gridItemWidth = {{ grid_item_width | json }};
    window.usf_productRatio = {{ product_ratio | json }};
    window._usfNew = {{ 'products.product.new' | t | json }};
    window._usfFrom = {{ 'products.general.from_price' | t | json }}
  </script>
	<div class="container">
		<style>
#usf_container{
    visibility:hidden;
}
</style>
<div id="usf_container"></div>
<div class="usf-skeleton-container">
	<style>              
	  @media (max-width: 749px){
		.usf-mobile-hidden{
		  display: none !important;
		}
		.usf-skeleton-container .usf-sr-config__mobile-filters-wrapper{
		  display: flex;
		  width: 100%;
		  flex-wrap: wrap;
		}
		.usf-skeleton-container .usf-filters, 
		.usf-skeleton-container .usf-sr-config__mobile-filters-wrapper .usf-c-select{
		  height: 49px;
		  border: 1px solid #ededed;
		  width: 50%;
		  border-left: none;
		  display: flex !important;
		  align-items: center;
		}
		.usf-skeleton-container .usf-filters{
		  border-left: 1px solid #ededed;
		}

		.usf-skeleton-container .usf-results{
		  height: 400px;
		  margin-left: -20px;
		  display: flex;
		  flex-wrap: wrap;
		}
		.usf-skeleton-container .usf-sr-config{
		  display: flex;
		  align-items: center;
		  justify-content: space-between;
		  margin-top: 13px;
		  flex-wrap: wrap;
		}
		
		.usf-skeleton-container .usf-sr-summary:before{
		  margin: 0 !important;
		  width: 100px !important;
		}
		.usf-skeleton-container .usf-views:before{
		  margin: 0 !important;
		  width: 50px !important;
		  margin-left: auto !important;
		}
		.usf-skeleton-container .usf-grid__item{
		  width: 50%;
		  padding-left: 20px;
		}
		.usf-skeleton-container .usf-sr-summary, 
		.usf-skeleton-container .usf-views{
		  margin: 30px 0 20px 0;
		  display: block;
		  width: 50%;
		}
		
		.usf-skeleton-container .usf-filters:before,
		.usf-skeleton-container .usf-c-select:before{
		  margin: 30px;
		}
		
		.usf-skeleton-container .usf-sr-container{
		  width: 100%;
		  padding: 0;
		  float: none;
		}
	  }
	  
	  .usf-skeleton-container .usf-filters:before,
	  .usf-skeleton-container .usf-c-select:before,
	  .usf-skeleton-container .usf-sr-summary:before,
	  .usf-skeleton-container .usf-views:before,
	  .usf-skeleton-container .usf-facet .usf-title:before,
	  .usf-skeleton-container .usf-facet .usf-body:before,
	  .usf-skeleton-container .usf-facet .usf-body:after              
	  {
		content:'';
		display: block;
		background-color: #0000000b;
		-webkit-animation: usf-skeleton-animation 2.3s infinite;
		animation: usf-skeleton-animation 2.3s infinite;
		height: 10px;
		border-radius: 10px;
		width: 100%;                
	  }
	  
	  @keyframes usf-skeleton-animation {
		0% {
			opacity: 1
		}

		50% {
			opacity: .5
		}

		100% {
			opacity: 1
		}
	  }
	  
	  @media (min-width: 750px){
		.usf-skeleton-container .usf-desktop-hidden{
		  display: none !important;
		}
		.usf-skeleton-container .usf-facet .usf-title,
		.usf-skeleton-container .usf-facet .usf-body,
		.usf-skeleton-container .usf-c-select
		{
		  display: block !important;
		}              
	  
		.usf-skeleton-container .usf-sr-config__mobile-filters-wrapper{
		  display: none;
		}
		
		.usf-skeleton-container .usf-facets{
		  display: block;
		  width: 23%;
		  float: left;
		  margin-top: 17px;
		}
		
		.usf-skeleton-container .usf-sr-container {
		  width: 77%;
		  float: left;
		  padding-left: 30px;
		  margin-top: 17px;
		}
		
		.usf-skeleton-container .usf-sr-config{
		  display: flex;
		}
		
		.usf-skeleton-container .usf-sr-config > .usf-c-select{
		  width: 200px;
		}
		
		.usf-skeleton-container .usf-sr-summary{
		  width: 100%;
		}
		.usf-skeleton-container .usf-sr-summary:before{
		  margin: auto;
		  width: 200px;
		}
		.usf-skeleton-container .usf-views:before{
		}
		.usf-skeleton-container .usf-grid__item{
		  width: 50%;
		  padding-left: 20px;
		}
		.usf-skeleton-container .usf-views{
		  display: block;
		  width: 50px;
		}
		
		.usf-skeleton-container .usf-sr-container{
		  min-height: 700px;
		}
	  }  
	  
	  .usf-skeleton-container .usf-facet{
		margin-bottom: 40px;
	  }
	  
	  .usf-skeleton-container .usf-facet .usf-title:before{                
		margin-bottom: 25px;
		width: 70%;
	  }
	  
	  .usf-skeleton-container .usf-facet .usf-body:before,
	  .usf-skeleton-container .usf-facet .usf-body:after
	  {
		margin-bottom: 16px;
	  }
	</style>
  
	<div class="usf-facets usf-mobile-hidden">
	  <div class="usf-facet">
		<div class="usf-title"></div>
		<div class="usf-body"></div>                
	  </div>
	  <div class="usf-facet">
		<div class="usf-title"></div>
		<div class="usf-body"></div>
	  </div>
	</div>
	<div class="usf-sr-container">
	  <div class="usf-sr-config">
		<div class="usf-sr-config__mobile-filters-wrapper">
		  <div class="usf-filters"></div>
		  <div class="usf-c-select"></div>
		</div>
		<div class="usf-views usf-mobile-hidden"></div>
		<span class="usf-sr-summary"></span>
		<div class="usf-views usf-desktop-hidden"></div>
		<div class="usf-c-select usf-mobile-hidden"></div>
	  </div>
	  <div class="usf-results usf-grid">
		<div class="usf-grid__item"></div>
		<div class="usf-grid__item"></div>
		<div class="usf-grid__item"></div>
		<div class="usf-grid__item"></div>
	  </div>
	</div>       
</div>
	</div>
</section>
<!-- END USF -->

{% comment %}USF
<style>
.collection-sidebar.collection-sidebar,
.collection-sidebar.collection-sidebar .mfp-close {
    background-color: {{ settings.color_drawer_bg }};
}
</style>
{%- assign limit = section.settings.grid | times: section.settings.rows -%}
{% paginate collection.products by limit %}
<section class="section" data-section-id="{{ section.id }}" data-section-type="collection-template">

    <div class="collection collection--sidebar-{{ section.settings.sidebar_layout }}{% if collection.image and section.settings.show_collection_image %} collection--img{% endif %}{% if section.settings.center_title %} collection--center{% endif %}">

        <div class="container">
            <div class="collection__header{% if collection.image and section.settings.show_collection_image %} collection__header--img{% endif %}">
                {% if collection.image and section.settings.show_collection_image %}
                    <div class="collection__header-media o-ratio o-ratio--{{ section.settings.collection_image_height }}" style="background-image: url('{{ collection.image | img_url: '1x1' }}')">
                        <img
                            class="collection__header-img collection__header-img--{{ section.id }}"
                            src="{{ collection.image | img_url: '600x' }}"
                            srcset="{% render 'bgset', image: collection.image %}"
                            width="600"
                            height="{{ 600 | divided_by: collection.image.aspect_ratio | round }}"
                            alt="{{ collection.image.alt }}"
                            loading="lazy"
                        />
                    </div>
                {% endif %}
                <div class="collection__header-info">
                    <div class="section__title collection__header-info__title{% if section.settings.center_title %} section__title--center{% endif %}">
                        <h1 class="section__title-text collection__header-info__title-text">{{ collection.title }}</h1>
                    </div>
                    {% if collection.description != blank %}
                        <div class="collection__header-info__text rte rte--header">
                            {{ collection.description }}
                        </div>
                    {% endif %}
                </div>
            </div>

            {%- assign mobile_sizes = 100 | divided_by: section.settings.grid_mobile -%}
            {%- assign sizes = mobile_sizes -%}
            {% case section.settings.grid %}
                {% when 2 %}
                    {%- assign grid_item_width = 'u-1/2@phab' -%}
                    {%- assign image_size = '740x' -%}
                    {%- assign sizes = '(min-width: 561px) 50vw, ' | append: mobile_sizes | append: 'vw' -%}
                    {% if section.settings.show_sidebar and section.blocks.size > 0 and section.settings.sidebar_layout == 'sidebar' %}
                        {%- assign container_size = 'full' -%}
                    {% else %}
                        {%- assign container_size = 'large' -%}
                    {% endif %}
                {% when 3 %}
                    {%- assign grid_item_width = 'u-1/2@phab u-1/3@tab' -%}
                    {%- assign image_size = '520x' -%}
                    {%- assign sizes = '(min-width: 561px) 50vw, (min-width: 768px) 33vw, ' | append: mobile_sizes | append: 'vw' -%}
                    {% if section.settings.show_sidebar and section.blocks.size > 0 and section.settings.sidebar_layout == 'sidebar' %}
                        {%- assign container_size = 'full' -%}
                    {% else %}
                        {%- assign container_size = 'large' -%}
                    {% endif %}
                {% when 4 %}
                    {%- assign grid_item_width = 'u-1/3@tab u-1/4@desk' -%}
                    {%- assign image_size = '380x' -%}
                    {%- assign container_size = 'full' -%}
                    {%- assign sizes = '(min-width: 768px) 33vw, (min-width: 981px) 25vw, ' | append: mobile_sizes | append: 'vw' -%}
            {% endcase %}
        </div>

        <div class="container container--{{ container_size }}">
            <div class="collection-main" id="collection-main">

                <div class="collection-main__sort js-collection-sort{% if section.settings.sort_enable %} collection-main__sort--sort{% endif %}" data-default-sort="{{ collection.sort_by | default: collection.default_sort_by }}">
                    <div class="o-layout o-layout--right{% if section.settings.grid == 4 %} o-layout--small{% endif %}{% if section.settings.grid_mobile == '2' %} o-layout--small@tab-down{% endif %}">

                        {% comment %}Sidebar blocks count{% endcomment %}
                        {% if section.settings.show_sidebar and section.blocks.size > 0 %}
                            <div class="o-layout__item o-layout__item u-1/1 u-1/2@tab u-1/4@desk">
                                <div class="collection-main__filter">
                                    <a href="#" class="collection-main__filter-btn c-btn c-btn--primary c-btn--full js-collection-draw-trigger">{{ 'collections.general.filter_label' | t }}{% if current_tags %} ({{ current_tags | size }}){% endif %}</a>
                                </div>
                            </div>
                        {% endif %}
                        {% comment %}Sidebar blocks count{% endcomment %}

                        {% if section.settings.sort_enable %}
                            <div class="o-layout__item o-layout__item u-1/1 u-1/2@tab u-1/4@desk">

                                <div class="selector-wrapper collection-main__sort__selector">
                                    <label for="SortBy">{{ 'collections.sorting.title' | t }}</label>
                                    <select name="SortBy" id="SortBy">
                                        <option value="manual">{{ 'collections.sorting.featured' | t }}</option>
                                        <option value="best-selling">{{ 'collections.sorting.best_selling' | t }}</option>
                                        <option value="title-ascending">{{ 'collections.sorting.az' | t }}</option>
                                        <option value="title-descending">{{ 'collections.sorting.za' | t }}</option>
                                        <option value="price-ascending">{{ 'collections.sorting.price_ascending' | t }}</option>
                                        <option value="price-descending">{{ 'collections.sorting.price_descending' | t }}</option>
                                        <option value="created-descending">{{ 'collections.sorting.date_descending' | t }}</option>
                                        <option value="created-ascending">{{ 'collections.sorting.date_ascending' | t }}</option>
                                    </select>
                                </div>

                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="collection-products">

                    {% comment %}Sidebar blocks count{% endcomment %}
                    {% if section.settings.show_sidebar and section.blocks.size > 0 %}
                    <div class="o-layout">

                        <div class="o-layout__item u-1/1 u-1/4@desk">
                            <aside class="collection-sidebar collection-sidebar--{{ section.settings.sidebar_layout }} collection-sidebar--{{ settings.color_drawer_style }} js-collection-draw">
                                <div class="collection-sidebar__wrapper">
                                    {% for block in section.blocks %}
                                        {% if block.type == 'linklist' %}
                                            {% if linklists[block.settings.linklist].links.size > 0 %}
                                                <div class="collection-sidebar__section">
                                                    <h4 class="collection-sidebar__title h5">{{ linklists[block.settings.linklist].title }}</h4>
                                                    <ul class="collection-sidebar__items o-list-bare">
                                                        {% for link in linklists[block.settings.linklist].links %}
                                                            <li class="collection-sidebar__item{% if link.active %} collection-sidebar__item--active{% endif %}">
                                                                <a href="{{ link.url }}" class="collection-sidebar__link">{{ link.title }}</a>
                                                            </li>
                                                        {% endfor %}
                                                    </ul>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                        {% if block.type == 'tags' %}
                                            {% if collection.all_tags.size > 0 %}
                                                <div class="collection-sidebar__section collection-sidebar__section--tags">
                                                    <h4 class="collection-sidebar__title h5">
                                                        {{ block.settings.title | escape }}
                                                    </h4>
                                                    <ul class="collection-sidebar__items o-list-bare">
                                                        {% for tag in collection.all_tags %}
                                                            {%- if tag contains '_HIDDEN_PRODUCT' -%}{%- continue -%}{%- endif -%}{% if current_tags contains tag %}
                                                                <li class="collection-sidebar__item collection-sidebar__item--active">
                                                                    {{ tag | link_to_remove_tag: tag | replace: ' title', ' class="collection-sidebar__link" title' }}
                                                                </li>
                                                            {% endif %}
                                                        {% endfor %}
                                                        {% for tag in collection.all_tags %}
                                                            {%- if tag contains '_HIDDEN_PRODUCT' -%}{%- continue -%}{%- endif -%}{% unless current_tags contains tag %}
                                                                <li class="collection-sidebar__item">
                                                                    {{ tag | link_to_add_tag: tag | replace: ' title', ' class="collection-sidebar__link" title' }}
                                                                </li>
                                                            {% endunless %}
                                                        {% endfor %}
                                                    </ul>
                                                </div>
                                                {% if current_tags %}
                                                    <div class="collection-sidebar__section collection-sidebar__section--group-clear">
                                                        <a href="{{ collection.url }}" class="c-btn c-btn--small c-btn--light c-btn--close">{{ 'collections.general.tags_clear_filters' | t }}</a>
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                        {% endif %}
                                        {% if block.type == 'group' %}
                                            {% if template contains 'collection' and collection.all_tags.size > 1 %}
                                                <!-- A recursive loop to catch and filter out the different tag categories -->
                                                {% assign c = 0 %}
                                                {% for t in collection.all_tags %}
                                                    {%- if t contains '_HIDDEN_PRODUCT' -%}{%- continue -%}{%- endif -%}{% capture cat %}{{ cat }}{% capture temp_cat %}{% if t contains '_' %}{% assign cat_grp = t | split: '_' %}{{ cat_grp.first }}{% endif %}{% endcapture %}{% unless cat contains temp_cat %}{% if t contains '_' %}{% assign new_cat_grp = t | split: '_' %}{{ new_cat_grp.first }}{% endif %}{% unless forloop.last %}+{% endunless %}{% assign c = c | plus: 1 %}{% endunless %}{% endcapture %}
                                                {% endfor %}

                                                <!-- create array of tag categories -->
                                                {% assign cat_array = cat | split: '+' %}

                                                <!-- loop through tag categories -->
                                                {% for i in cat_array %}
                                                    <!-- ignore if tag category is empty -->
                                                    {% unless i == '' %}
                                                        <div class="collection-sidebar__section collection-sidebar__section--tags collection-sidebar__section--group">
                                                            <h4 class="collection-sidebar__title h5">{{ i }}</h4>
                                                            <ul class="collection-sidebar__items o-list-bare">
                                                                <!-- loop through collection tags -->
                                                                {% for t in collection.all_tags %}
                                                                    {%- if t contains '_HIDDEN_PRODUCT' -%}{%- continue -%}{%- endif -%}<!-- if tag contains the category title -->
                                                                    {% if t contains i %}
                                                                        <!-- strip out tag category prefix and add/remove link for tag filtering -->
                                                                        {% if current_tags contains t %}
                                                                          <li class="collection-sidebar__item collection-sidebar__item--active js-active" data-category-group="{{ i | downcase }}" data-tag-url="{{ t | handleize }}">
                                                                              {{ t | remove: i | remove: '_' | link_to_remove_tag: t | replace: ' title', ' class="js-no-transition collection-sidebar__link js-collection-group-link" title' }}
                                                                          </li>
                                                                        {% else %}
                                                                          <li class="collection-sidebar__item" data-category-group="{{ i | downcase }}" data-tag-url="{{ t | handleize }}">
                                                                              {{ t | remove: i | remove: '_' | link_to_add_tag: t | replace: ' title', ' class="js-no-transition collection-sidebar__link js-collection-group-link" title' }}
                                                                          </li>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </ul>
                                                        </div>
                                                    {% endunless %}
                                                {% endfor %}

                                                {% if current_tags %}
                                                    <div class="collection-sidebar__section collection-sidebar__section--group-clear">
                                                        <a href="{{ collection.url }}" class="c-btn c-btn--small c-btn--light c-btn--close">{{ 'collections.general.tags_clear_filters' | t }}</a>
                                                    </div>
                                                {% endif %}

                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </aside>
                        </div>

                        <div class="o-layout__item u-1/1 {% if section.settings.sidebar_layout == 'sidebar' %}u-3/4@desk{% else %}u-1/1@desk{% endif %}">

                    {% endif %}
                    {% comment %}Sidebar blocks count{% endcomment %}

                            <div class="o-layout{% if settings.product_grid_masonry %} o-layout--masonry{% endif %}{% if section.settings.grid == 4 %} o-layout--small{% endif %}{% if section.settings.grid_mobile == '2' %} o-layout--small@tab-down{% endif %}">
                                {% for product in collection.products %}
                                    {%- if product.metafields.inventory.ShappifyHidden == 'true' -%}{%- continue -%}{%- endif -%}
<div class="o-layout__item u-1/{{ section.settings.grid_mobile }} {{ grid_item_width }}">
                                        {% render 'product-grid-item', product: product, page: 'collection', image_sizes: sizes %}
                                    </div>
                                {% else %}
                                    {% if collection.handle == 'all' and collection.all_vendors.size == 0 and collection.all_types.size == 0 %}
                                        {% comment %}
                                            Add default products to help with onboarding for collections/all only.
                                        {% endcomment %}
                                        {% for i in (1..8) %}
                                            <div class="o-layout__item u-1/{{ section.settings.grid_mobile }} {{ grid_item_width }}">
                                                <a href="#" class="product-link home-products__link">
                                                    <div class="product product--{{ settings.product_grid_align }}">
                                                        <div class="product__media">
                                                            {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
                                                            {{ 'product-' | append: current | placeholder_svg_tag: 'product__img placeholder-svg placeholder-svg--light' }}
                                                        </div>
                                                        <div class="product__details product__details--{{ settings.product_grid_text_size }}">
                                                            <h3 class="product__title">{{ 'homepage.onboarding.product_title' | t }}</h3>
                                                            {% if settings.product_grid_vendor %}
                                                                <p class="product__vendor">{{ 'homepage.onboarding.product_vendor' | t }}</p>
                                                            {% endif %}
                                                            <p class="product__price">
                                                                {% render 'product-price', product: product %}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="o-layout__item 1/1">
                                            <div class="collection-empty">
                                                <h5 class="collection-empty__title">{{ 'collections.general.no_matches' | t }}</h5>
                                                <span class="emoji collection-empty__emoji">
                                                    <i class="icon icon--confused"></i>
                                                </span>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>

                    {% comment %}Sidebar blocks count{% endcomment %}
                    {% if section.settings.show_sidebar and section.blocks.size > 0 %}
                        </div>
                    </div>
                    {% endif %}
                    {% comment %}Sidebar blocks count{% endcomment %}
                </div>

            </div>

            {% if paginate.pages > 1 %}
                <div class="collection-pagination">
                    <div class="container">
                        <div class="pagination">
                            <div class="pagination__items">
                                {{ paginate | default_pagination: 
                                    next:'<i class="icon icon--right-t"></i><span class="icon-fallback__text">Next Page</span>',
                                    previous: '<i class="icon icon--left-t"></i><span class="icon-fallback__text">Previous Page</span>'
                                }}
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

        </div>

    </div>
</section>

{% endpaginate %}


USF{% endcomment %}
{% schema %}
{
    "name": "Collection page",
    "class": "js-section__collection",
    "max_blocks": 6,
    "settings": [
        {
            "type": "range",
            "id": "grid",
            "label": "Products per row (desktop)",
            "min": 2,
            "max": 4,
            "step": 1,
            "default": 3
        },
        {
            "type": "select",
            "id": "grid_mobile",
            "label": "Products per row (mobile)",
            "default": "1",
            "options": [
                {
                    "label": "1",
                    "value": "1"
                },
                {
                    "label": "2",
                    "value": "2"
                }
            ]
        },
        {
            "type": "range",
            "id": "rows",
            "label": "Rows",
            "min": 2,
            "max": 12,
            "step": 1,
            "default": 6
        },
        {
            "type": "checkbox",
            "id": "center_title",
            "label": "Center heading and text",
            "default": false
        },
        {
            "type": "checkbox",
            "id": "sort_enable",
            "label": "Enable sorting",
            "default": true
        },
        {
            "type": "header",
            "content": "Collection image"
        },
        {
            "type": "checkbox",
            "id": "show_collection_image",
            "label": "Show image",
            "default": true
        },
        {
            "type": "select",
            "id": "collection_image_height",
            "label": "Image height",
            "default": "3:1",
            "options": [
                {
                    "label": "Small",
                    "value": "4:1"
                },
                {
                    "label": "Medium",
                    "value": "3:1"
                },
                {
                    "label": "Large",
                    "value": "5:2"
                }
            ]
        },
        {
            "type": "select",
            "id": "image_alignment",
            "label": "Image alignment",
            "default": "center",
            "options": [
                {
                    "value": "top",
                    "label": "Top"
                },
                {
                    "value": "center",
                    "label": "Middle"
                },
                {
                    "value": "bottom",
                    "label": "Bottom"
                }
            ]
        },
        {
            "type": "header",
            "content": "Filters"
        },
        {
            "type": "checkbox",
            "id": "show_sidebar",
            "label": "Enable filters",
            "default": false
        },
        {
            "type": "select",
            "id": "sidebar_layout",
            "label": "Desktop layout",
            "default": "sidebar",
            "options": [
                {
                    "value": "sidebar",
                    "label": "Sidebar"
                },
                {
                    "value": "drawer",
                    "label": "Drawer"
                }
            ]
        }
    ],
    "blocks": [
        {
            "type": "linklist",
            "name": "Menu",
            "settings": [
                {
                    "type": "link_list",
                    "id": "linklist",
                    "label": "Menu",
                    "info": "This menu won't show dropdown items"
                }
            ]
        },
        {
            "type": "tags",
            "name": "All tags",
            "limit": 1,
            "settings": [
                {
                    "type": "text",
                    "id": "title",
                    "label": "Heading",
                    "default": "Filter"
                }
            ]
        },
        {
            "type": "group",
            "name": "Tag groups",
            "limit": 1,
            "settings": [
                {
                    "type": "paragraph",
                    "content": "Filtering by tag groups requires tag formatting. [Learn more](https://support.safeasmilk.co/article/113-collection-page-add-custom-tag-groups-for-filtering)"
                }
            ]
        }
    ]
}
{% endschema %}
